# MoneyForward ME
## CSVファイルのダウンロード

ブラウザ Chrome で MoneyForward ME にログインした状態で、下記のようにスクリプトを実行する。  
Chrome でダウンロードしたファイルの保存先は、`~/Download` 前提。  
（動作確認は、MacBook Air (M1, 2020)のみでしか確認していません。）  

1. Chrome で MoneyForward ME にログインする。  
   https://moneyforward.com/
2. ターミナルから、下記のようにスクリプトを実行する。  
   ```shell
   ./download_csv.sh 2020/04 2023/04
   ```
   第１引数は開始年月、第２引数は、終了年月
3. 正常にスクリプトが実行されれば、`./download`ディレクトリが作成され、  
   `収入・支出詳細_2022-04-01_2022-04-30.csv` のような名前のCSVファイルがダウンロードされる。  

参考までに、シェルスクリプト中では、以下のようなコマンドを繰り返して実行している。  
```shell
open -a "Google Chrome" -g https://moneyforward.com/cf/csv?from=2023/01/01&month=1&year=2023
```

## ダウンロードしたCSVファイルの確認

ダウンロードしたファイルを`less`や、`cat`で確認してしようとすると、下記のように文字化けしてしまう。  
```
$ cat ./download/収入・支出詳細_2023-04-01_2023-04-30.csv
"�v�Z�Ώ�","���t","���e","���z�i�~�j","�ۗL���Z�@��","�區��","������","����","�U��","ID"
"1","2023/04/30","�I�v�e�[�W���p����","-1521","�y�V�J�[�h","�ʐM��","�g�ѓd�b","","0","ErQWwinQh7hxbwKtcEep1w"
"1","2023/04/30","�I�v�e�[�W���p����","-1649","�y�V�J�[�h","�ʐM��","�g�ѓd�b","","0","z9k0DFVI6-cdKLZ6UJFEMw"
"1","2023/04/30","So-net","-110","�y�V�J�[�h","�ʐM��","�C���^�[�l�b�g","","0","_sTY0P5-dY0RwU5lO1RXxA"
```

下記のように、`iconv`を使うと、文字化けを起こさずに、読むことができる。  
```
$ iconv -f SJIS ./download/収入・支出詳細_2023-04-01_2023-04-30.csv
"計算対象","日付","内容","金額（円）","保有金融機関","大項目","中項目","メモ","振替","ID"
"1","2023/04/30","オプテージ利用料金","-1521","楽天カード","通信費","携帯電話","","0","ErQWwinQh7hxbwKtcEep1w"
"1","2023/04/30","オプテージ利用料金","-1649","楽天カード","通信費","携帯電話","","0","z9k0DFVI6-cdKLZ6UJFEMw"
"1","2023/04/30","So-net","-110","楽天カード","通信費","インターネット","","0","_sTY0P5-dY0RwU5lO1RXxA"
```

## CSVファイルの整形

ダウンロードしたCSVファイルは少々扱いづらいので、下記のためのスクリプトを用意した。  
整形の目的は、Googleスプレッドシートにインポートして、オリジナルの家計簿として管理するため。  

 - 収入を削除し、支出のみに
 - 支出の金額を - から + へ
 - 計算対象 = 0 の項目を削除
 - 不要列（"計算対象", "ID", "保有金融機関", "中項目", "振替"）の削除
 - 日付を新しい順から古い順へ
 - 無視したい項目を削除（ignore_expense_list.csv に無視したい項目を列挙）

スクリプトの実行方法は以下。整形後のファイルは、`expense_output.csv`というファイル名で出力される。  
```
$ python create_expense.py download/収入・支出詳細_2022-02-01_2022-02-28.csv 
```

無視したい項目は、下記のように、列名、値を`ignore_expense_list.csv`に記入した状態でスクリプトを実行する。  
```
列名,値
"保有金融機関","パルシステム"
"内容","THEOツミタテ"
"内容","ウエルスナビ"
```